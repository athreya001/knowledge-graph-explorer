<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="A client-side explorer for the Google Knowledge Graph API. Search entities, view JSON data, and explore relationships.">
  <title>Knowledge Graph Explorer</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            slate: { 850: '#1e293b', 900: '#0f172a' }
          }
        }
      }
    }
  </script>
  
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  
  <style>
    /* JSON Syntax Highlighting */
    .json-key { color: #d946ef; } /* Fuchsia-500 */
    .json-value { color: #3b82f6; } /* Blue-500 */
    .json-string { color: #22c55e; } /* Green-500 */
    .dark .json-key { color: #e879f9; }
    .dark .json-value { color: #60a5fa; }
    .dark .json-string { color: #4ade80; }
    
    pre { white-space: pre-wrap; word-wrap: break-word; }

    /* Scrollbars */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    .dark ::-webkit-scrollbar-thumb { background: #475569; }
    .dark ::-webkit-scrollbar-thumb:hover { background: #64748b; }

    /* Animations */
    @keyframes fadeInUp {
      from { opacity: 0; transform: translate3d(0, 20px, 0); }
      to { opacity: 1; transform: translate3d(0, 0, 0); }
    }
    .animate-fade-in-up { animation: fadeInUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
    
    @keyframes shimmer {
      0% { background-position: -1000px 0; }
      100% { background-position: 1000px 0; }
    }
    .skeleton {
      background: linear-gradient(to right, #f1f5f9 4%, #e2e8f0 25%, #f1f5f9 36%);
      background-size: 1000px 100%;
      animation: shimmer 2s infinite linear;
    }
    .dark .skeleton {
      background: linear-gradient(to right, #1e293b 4%, #334155 25%, #1e293b 36%);
    }
  </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen font-sans transition-colors duration-300 dark:bg-slate-900 dark:text-slate-100 flex flex-col">
  
  <div id="toastContainer" class="fixed top-5 right-5 z-50 flex flex-col gap-3 pointer-events-none"></div>

  <header class="bg-white/80 dark:bg-slate-800/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-700 sticky top-0 z-40 transition-colors duration-300">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3 cursor-pointer" onclick="window.location.href=window.location.pathname">
        <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center text-white shadow-lg shadow-blue-500/30">
          <i class="fa-solid fa-project-diagram text-xl"></i>
        </div>
        <div>
          <h1 class="text-lg font-bold leading-none tracking-tight">KG Explorer</h1>
          <p class="text-xs text-slate-500 dark:text-slate-400 font-mono mt-1">Google Knowledge Graph API</p>
        </div>
      </div>
      
      <div class="flex items-center gap-3">
        <a href="https://github.com" target="_blank" class="p-2 text-slate-400 hover:text-slate-800 dark:hover:text-white transition-colors">
          <i class="fa-brands fa-github text-xl"></i>
        </a>
        <button id="themeToggle" class="w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-yellow-400 hover:bg-slate-200 dark:hover:bg-slate-600 transition-all focus:outline-none focus:ring-2 focus:ring-blue-500">
          <i class="fa-solid fa-moon dark:hidden"></i>
          <i class="fa-solid fa-sun hidden dark:inline"></i>
        </button>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-8 flex-grow w-full">
    
    <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 p-6 mb-8 transition-colors duration-300">
      
      <div id="apiKeyNote" class="hidden mb-6 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-4 text-sm text-amber-800 dark:text-amber-200 flex items-start gap-3">
        <i class="fa-solid fa-shield-cat mt-0.5"></i>
        <div class="flex-1">
          <strong>Security Note:</strong> Your API Key is stored locally in your browser (`localStorage`). It is never sent to any server other than Google's API.
        </div>
        <button onclick="document.getElementById('apiKeyNote').classList.add('hidden')" class="hover:text-amber-900 dark:hover:text-white"><i class="fa-solid fa-xmark"></i></button>
      </div>

      <div class="grid gap-5 md:grid-cols-[1fr_2fr_auto]">
        <div class="relative group">
          <label class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-1.5">API Key</label>
          <div class="relative">
            <i class="fa-solid fa-key absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 z-10"></i>
            <input type="password" id="apiKey"
              class="w-full pl-10 pr-10 py-2.5 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-sm font-mono dark:text-white"
              placeholder="Paste Google API Key">
            <button onclick="toggleKeyVisibility()" class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-200">
              <i class="fa-solid fa-eye" id="eyeIcon"></i>
            </button>
          </div>
        </div>

        <div class="relative">
          <label class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-1.5">Search Query</label>
          <div class="relative">
            <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 z-10"></i>
            <input type="text" id="searchQuery"
              class="w-full pl-10 pr-10 py-2.5 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all dark:text-white"
              placeholder="e.g. Taylor Swift OR kg:/m/05f4p"
              oninput="toggleClearBtn()">
            <button id="clearSearchBtn" onclick="clearSearch()" class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-red-500 hidden transition-colors">
              <i class="fa-solid fa-circle-xmark"></i>
            </button>
          </div>
        </div>

        <div class="flex items-end">
          <button onclick="initiateSearch()" id="searchBtn"
            class="h-[46px] px-8 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-xl shadow-lg shadow-blue-500/30 hover:shadow-blue-500/50 transition-all flex items-center gap-2 active:scale-95 w-full md:w-auto justify-center">
            <span>Explore</span>
            <i class="fa-solid fa-rocket"></i>
          </button>
        </div>
      </div>

      <div id="recentSearchesContainer" class="hidden mt-4 pt-4 border-t border-slate-100 dark:border-slate-700">
        <div class="flex items-center gap-2 overflow-x-auto pb-2 scrollbar-hide" id="recentSearchesList"></div>
      </div>

      <div class="mt-4 pt-4 border-t border-slate-100 dark:border-slate-700">
        <details class="group">
          <summary class="flex items-center gap-2 text-xs font-semibold text-slate-500 dark:text-slate-400 cursor-pointer hover:text-blue-600 dark:hover:text-blue-400 transition-colors select-none">
            <i class="fa-solid fa-sliders transition-transform group-open:rotate-180"></i>
            <span>FILTER PARAMETERS</span>
          </summary>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4 animate-fade-in-up">
            <div>
              <label class="block text-[10px] uppercase text-slate-400 mb-1">Limit</label>
              <input type="number" id="limit" value="10" min="1" max="50" class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg text-sm dark:text-white focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            <div>
              <label class="block text-[10px] uppercase text-slate-400 mb-1">Language</label>
              <input type="text" id="languages" value="en" class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg text-sm dark:text-white focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            <div class="col-span-2 md:col-span-2">
              <label class="block text-[10px] uppercase text-slate-400 mb-1">Types (Comma separated)</label>
              <input type="text" id="types" placeholder="e.g. Person, Organization" class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg text-sm dark:text-white focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
          </div>
        </details>
      </div>
    </div>

    <div id="resultsWrapper">
      
      <div id="skeletonLoader" class="hidden grid-cols-1 gap-6">
        <div class="bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-0 overflow-hidden flex flex-col md:flex-row h-48">
          <div class="w-full md:w-48 bg-slate-200 dark:bg-slate-700 skeleton h-full"></div>
          <div class="p-6 flex-1 space-y-4">
            <div class="h-6 w-1/3 bg-slate-200 dark:bg-slate-700 rounded skeleton"></div>
            <div class="h-4 w-1/4 bg-slate-200 dark:bg-slate-700 rounded skeleton"></div>
            <div class="h-16 w-full bg-slate-200 dark:bg-slate-700 rounded skeleton"></div>
          </div>
        </div>
        <div class="bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-0 overflow-hidden flex flex-col md:flex-row h-48">
          <div class="w-full md:w-48 bg-slate-200 dark:bg-slate-700 skeleton h-full"></div>
          <div class="p-6 flex-1 space-y-4">
            <div class="h-6 w-1/3 bg-slate-200 dark:bg-slate-700 rounded skeleton"></div>
            <div class="h-4 w-1/4 bg-slate-200 dark:bg-slate-700 rounded skeleton"></div>
            <div class="h-16 w-full bg-slate-200 dark:bg-slate-700 rounded skeleton"></div>
          </div>
        </div>
      </div>

      <div id="resultControls" class="hidden flex justify-between items-center mb-4 px-1 animate-fade-in-up">
        <div id="countHeader" class="text-sm text-slate-500 dark:text-slate-400"></div>
        <button onclick="downloadAllResults()" class="text-xs bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-400 px-3 py-1.5 rounded-lg transition-all flex items-center gap-2 shadow-sm">
          <i class="fa-solid fa-download"></i> Download JSON
        </button>
      </div>

      <div id="resultsContainer" class="grid grid-cols-1 gap-6 pb-20">
        <div class="text-center py-20 opacity-50">
          <i class="fa-brands fa-google text-6xl text-slate-300 dark:text-slate-600 mb-4"></i>
          <p class="text-slate-400 dark:text-slate-500 text-lg">Enter a query to start exploring.</p>
        </div>
      </div>
    </div>
  </main>

  <footer class="bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 py-6 mt-auto">
    <div class="max-w-6xl mx-auto px-4 text-center">
      <p class="text-xs text-slate-400 dark:text-slate-500">
        Not affiliated with Google. Data provided via Google Knowledge Graph API.
        <br>Run entirely in your browser.
      </p>
    </div>
  </footer>

  <div id="jsonModal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm hidden items-center justify-center z-50 p-4 transition-all duration-300">
    <div class="bg-white dark:bg-slate-800 w-full max-w-4xl max-h-[85vh] rounded-2xl shadow-2xl flex flex-col overflow-hidden animate-fade-in-up border border-slate-200 dark:border-slate-700">
      <div class="p-4 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-800/50">
        <h3 class="font-bold text-slate-700 dark:text-slate-200 flex items-center gap-2 font-mono text-sm">
          <i class="fa-solid fa-code text-blue-500"></i> Raw Response
        </h3>
        <button onclick="closeModal()" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-400 transition-colors">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
      <div class="overflow-auto p-0 flex-1 bg-[#f8f9fa] dark:bg-[#0d1117]">
        <pre id="modalContent" class="text-xs font-mono p-6"></pre>
      </div>
      <div class="p-4 border-t border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 flex justify-end">
        <button id="copyBtn" onclick="copyModalContent()" class="text-xs font-semibold text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/30 px-4 py-2 rounded-lg transition-colors border border-transparent hover:border-blue-100 dark:hover:border-blue-800 flex items-center gap-2">
          <i class="fa-regular fa-copy"></i> Copy JSON
        </button>
      </div>
    </div>
  </div>

  <script>
    // --- State Management ---
    window.fullResponseData = null;
    let searchTimeout = null;

    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
      loadSettings();
      setupTheme();
      renderHistory();
      
      // Check URL params for shared searches
      const urlParams = new URLSearchParams(window.location.search);
      const queryParam = urlParams.get('q');
      if (queryParam) {
        document.getElementById('searchQuery').value = queryParam;
        toggleClearBtn();
        // Give time for UI to settle before auto-searching
        setTimeout(() => {
            if(document.getElementById('apiKey').value) initiateSearch();
            else showToast('Enter API Key to run shared search', 'info');
        }, 500);
      }
    });

    // --- Theme Logic ---
    function setupTheme() {
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;
        
        // Check local storage or system preference
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            html.classList.add('dark');
        } else {
            html.classList.remove('dark');
        }

        themeToggle.addEventListener('click', () => {
            html.classList.toggle('dark');
            localStorage.theme = html.classList.contains('dark') ? 'dark' : 'light';
        });
    }

    // --- Input Handling ---
    document.getElementById('searchQuery').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') initiateSearch();
    });

    function toggleClearBtn() {
      const query = document.getElementById('searchQuery').value;
      const btn = document.getElementById('clearSearchBtn');
      query.length > 0 ? btn.classList.remove('hidden') : btn.classList.add('hidden');
    }

    function clearSearch() {
      const input = document.getElementById('searchQuery');
      input.value = '';
      input.focus();
      toggleClearBtn();
      // Update URL to remove query
      const url = new URL(window.location);
      url.searchParams.delete('q');
      window.history.pushState({}, '', url);
    }

    function toggleKeyVisibility() {
        const input = document.getElementById('apiKey');
        const icon = document.getElementById('eyeIcon');
        if (input.type === 'password') {
            input.type = 'text';
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        } else {
            input.type = 'password';
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        }
    }

    // --- LocalStorage Logic ---
    function loadSettings() {
      const savedKey = localStorage.getItem('kg_api_key');
      if (savedKey) {
        document.getElementById('apiKey').value = savedKey;
      } else {
        document.getElementById('apiKeyNote').classList.remove('hidden');
      }
    }

    function addToHistory(query) {
      if(!query) return;
      let history = JSON.parse(localStorage.getItem('kg_search_history') || '[]');
      history = history.filter(q => q.toLowerCase() !== query.toLowerCase());
      history.unshift(query);
      if (history.length > 8) history = history.slice(0, 8);
      localStorage.setItem('kg_search_history', JSON.stringify(history));
      renderHistory();
    }

    function renderHistory() {
      const history = JSON.parse(localStorage.getItem('kg_search_history') || '[]');
      const list = document.getElementById('recentSearchesList');
      const container = document.getElementById('recentSearchesContainer');
      
      if (history.length === 0) {
        container.classList.add('hidden');
        return;
      }
      container.classList.remove('hidden');
      list.innerHTML = '';
      
      // Add "Clear" button first
      const clearBtn = document.createElement('button');
      clearBtn.className = "text-xs font-semibold text-red-400 hover:text-red-600 px-3 py-1.5 transition-colors whitespace-nowrap";
      clearBtn.innerHTML = '<i class="fa-solid fa-trash-can mr-1"></i> Clear';
      clearBtn.onclick = () => {
          localStorage.removeItem('kg_search_history');
          renderHistory();
      };
      list.appendChild(clearBtn);

      history.forEach(q => {
        const btn = document.createElement('button');
        btn.className = "text-xs bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 text-slate-600 dark:text-slate-300 px-3 py-1.5 rounded-full transition-colors border border-slate-200 dark:border-slate-600 whitespace-nowrap";
        btn.textContent = q;
        btn.onclick = () => {
          document.getElementById('searchQuery').value = q;
          toggleClearBtn();
          initiateSearch();
        };
        list.appendChild(btn);
      });
    }

    // --- Core Search Logic ---
    async function initiateSearch() {
      const query = document.getElementById('searchQuery').value.trim();
      const apiKey = document.getElementById('apiKey').value.trim();
      const limit = document.getElementById('limit').value;
      const languages = document.getElementById('languages').value;
      const types = document.getElementById('types').value.trim();

      if (!query) {
        showToast('Please enter a search query', 'error');
        return;
      }
      if (!apiKey) {
        showToast('API Key is missing', 'error');
        document.getElementById('apiKey').focus();
        document.getElementById('apiKey').parentElement.classList.add('ring-2', 'ring-red-500', 'rounded-xl');
        setTimeout(() => document.getElementById('apiKey').parentElement.classList.remove('ring-2', 'ring-red-500'), 2000);
        return;
      }

      // Save Key
      localStorage.setItem('kg_api_key', apiKey);
      addToHistory(query);

      // Update URL without reload
      const url = new URL(window.location);
      url.searchParams.set('q', query);
      window.history.pushState({}, '', url);

      // UI States
      document.getElementById('resultsContainer').innerHTML = '';
      document.getElementById('skeletonLoader').classList.remove('hidden');
      document.getElementById('skeletonLoader').classList.add('grid');
      document.getElementById('resultControls').classList.add('hidden');
      document.getElementById('searchBtn').disabled = true;
      document.getElementById('searchBtn').innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i>';

      // --- SMART ID DETECTION START ---
      // Check if input looks like an Entity ID (e.g., /m/05f4p or kg:/m/05f4p)
      // Allows optional 'kg:' prefix, then requires /m/ or /g/ followed by chars
      const idRegex = /^(kg:)?(\/[mg]\/[a-zA-Z0-9_\-]+)$/i;
      const idMatch = query.match(idRegex);

      let apiUrl = `https://kgsearch.googleapis.com/v1/entities:search?key=${apiKey}&limit=${limit}&indent=true`;
      
      if (idMatch) {
        // It is an ID! Use 'ids' parameter and strip 'kg:' if present
        const cleanId = idMatch[2]; // Group 2 is the /m/... part
        apiUrl += `&ids=${encodeURIComponent(cleanId)}`;
        showToast('Searching by Entity ID...', 'info');
      } else {
        // Standard text search
        apiUrl += `&query=${encodeURIComponent(query)}`;
      }
      // --- SMART ID DETECTION END ---

      if (languages) apiUrl += `&languages=${encodeURIComponent(languages)}`;
      if (types) apiUrl += `&types=${encodeURIComponent(types)}`;

      try {
        const response = await fetch(apiUrl);
        const data = await response.json();

        if (!response.ok) throw new Error(data.error ? data.error.message : 'Network response was not ok');
        
        window.fullResponseData = data;
        renderResults(data);
      } catch (error) {
        console.error(error);
        showToast(error.message, 'error');
        document.getElementById('resultsContainer').innerHTML = `
           <div class="text-center py-12 bg-red-50 dark:bg-red-900/10 rounded-xl border border-red-100 dark:border-red-900/30">
            <i class="fa-solid fa-triangle-exclamation text-3xl text-red-500 mb-3"></i>
            <p class="text-red-600 dark:text-red-400 font-medium">Search Failed</p>
            <p class="text-red-400 dark:text-red-500/70 text-sm mt-1">${error.message}</p>
          </div>
        `;
      } finally {
        document.getElementById('skeletonLoader').classList.add('hidden');
        document.getElementById('skeletonLoader').classList.remove('grid');
        document.getElementById('searchBtn').disabled = false;
        document.getElementById('searchBtn').innerHTML = '<span>Explore</span><i class="fa-solid fa-rocket"></i>';
      }
    }

    function renderResults(data) {
      const container = document.getElementById('resultsContainer');
      const items = data.itemListElement || [];

      if (items.length === 0) {
        container.innerHTML = `
          <div class="text-center py-12 bg-slate-50 dark:bg-slate-800/50 rounded-xl border border-dashed border-slate-300 dark:border-slate-700">
            <p class="text-slate-500">No results found for this query.</p>
          </div>
        `;
        return;
      }

      document.getElementById('resultControls').classList.remove('hidden');
      document.getElementById('resultControls').classList.add('flex');
      document.getElementById('countHeader').innerText = `Found ${items.length} entities`;

      items.forEach((item, index) => {
        const entity = item.result;
        const score = item.resultScore ? Math.round(item.resultScore) : 0;
        
        // Data Extraction
        const name = entity.name || 'Unknown';
        const description = entity.description || 'No description';
        const detailedDesc = entity.detailedDescription ? entity.detailedDescription.articleBody : '';
        const wikiUrl = entity.detailedDescription ? entity.detailedDescription.url : entity.url;
        const imageUrl = entity.image ? entity.image.contentUrl : null;
        const id = entity['@id'] || '';
        const types = entity['@type'] || [];
        const typeArray = Array.isArray(types) ? types : [types];

        // --- Card HTML ---
        const card = document.createElement('div');
        card.className = "bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden hover:shadow-lg dark:hover:shadow-slate-900/50 transition-all duration-300 animate-fade-in-up flex flex-col md:flex-row group";
        card.style.animationDelay = `${index * 50}ms`;

        // Image Section
        const imgSection = imageUrl 
            ? `<div class="w-full md:w-48 h-48 md:h-auto bg-slate-100 dark:bg-slate-900 relative overflow-hidden flex-shrink-0">
                 <img src="${imageUrl}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" onerror="this.parentElement.innerHTML='<div class=\\'w-full h-full flex items-center justify-center text-slate-300 dark:text-slate-600\\'><i class=\\'fa-regular fa-image text-2xl\\'></i></div>'">
               </div>`
            : `<div class="w-full md:w-48 h-24 md:h-auto bg-slate-50 dark:bg-slate-900/50 flex-shrink-0 flex items-center justify-center text-slate-300 dark:text-slate-700 border-b md:border-b-0 md:border-r border-slate-100 dark:border-slate-700">
                 <i class="fa-regular fa-image text-3xl opacity-50"></i>
               </div>`;

        // Tags HTML
        const tagsHtml = typeArray.map(t => 
            `<button onclick="triggerSearch('${t}')" class="text-[10px] uppercase font-bold tracking-wider text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/30 px-2 py-1 rounded border border-blue-100 dark:border-blue-800 hover:bg-blue-100 dark:hover:bg-blue-800 transition-colors">${t}</button>`
        ).join('');

        // Content
        card.innerHTML = `
          ${imgSection}
          <div class="flex-1 p-5 flex flex-col relative">
            
            <div class="flex justify-between items-start">
               <div>
                  <h2 class="text-xl font-bold text-slate-800 dark:text-slate-100 mb-1 leading-tight">${name}</h2>
                  <button onclick="triggerSearch('${id}')" class="text-xs font-mono text-slate-400 dark:text-slate-500 hover:text-blue-500 dark:hover:text-blue-400 transition-colors mb-2 block text-left" title="Click to search ID">
                    <i class="fa-solid fa-fingerprint mr-1"></i>${id}
                  </button>
               </div>
               <div class="bg-slate-100 dark:bg-slate-700 text-slate-500 dark:text-slate-300 text-xs font-bold px-2 py-1 rounded flex items-center gap-1" title="Relevance Score">
                 <i class="fa-solid fa-star text-amber-400 text-[10px]"></i> ${score}
               </div>
            </div>

            <div class="flex flex-wrap gap-2 mb-3">
              ${tagsHtml}
            </div>

            <p class="text-slate-700 dark:text-slate-300 font-medium mb-2 text-sm">${description}</p>
            ${detailedDesc ? `<p class="text-slate-500 dark:text-slate-400 text-sm mb-4 line-clamp-3 leading-relaxed">${detailedDesc}</p>` : ''}

            <div class="mt-auto pt-4 flex items-center justify-between border-t border-slate-100 dark:border-slate-700">
              ${wikiUrl ? `<a href="${wikiUrl}" target="_blank" class="text-sm font-semibold text-blue-600 dark:text-blue-400 hover:underline flex items-center gap-1"><i class="fa-solid fa-arrow-up-right-from-square"></i> Read More</a>` : '<span></span>'}
              
              <button onclick="viewRawJson(${index})" class="text-xs font-semibold text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors flex items-center gap-1">
                <i class="fa-solid fa-code"></i> JSON
              </button>
            </div>
          </div>
        `;
        container.appendChild(card);
      });
      
      window.currentData = items;
    }

    // --- Helper Functions ---
    function triggerSearch(term) {
        document.getElementById('searchQuery').value = term;
        toggleClearBtn();
        initiateSearch();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function viewRawJson(index) {
      const item = window.currentData[index];
      const modal = document.getElementById('jsonModal');
      const content = document.getElementById('modalContent');
      
      content.innerHTML = syntaxHighlight(JSON.stringify(item, null, 2));
      modal.classList.remove('hidden');
      modal.classList.add('flex');
    }

    function closeModal() {
      const modal = document.getElementById('jsonModal');
      modal.classList.add('hidden');
      modal.classList.remove('flex');
    }

    function downloadAllResults() {
        if (!window.fullResponseData) return;
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(window.fullResponseData, null, 2));
        const el = document.createElement('a');
        el.href = dataStr;
        el.download = `kg_results_${Date.now()}.json`;
        el.click();
    }

    // --- Utilities ---
    function showToast(message, type = 'info') {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      
      const colors = type === 'error' 
        ? 'bg-red-500 text-white shadow-red-500/30' 
        : 'bg-slate-800 dark:bg-white text-white dark:text-slate-900 shadow-xl';
      
      const icon = type === 'error' ? '<i class="fa-solid fa-circle-exclamation"></i>' : '<i class="fa-solid fa-circle-info"></i>';

      toast.className = `${colors} px-4 py-3 rounded-lg shadow-lg flex items-center gap-3 text-sm font-medium transform transition-all duration-300 translate-y-10 opacity-0 pointer-events-auto min-w-[300px]`;
      toast.innerHTML = `${icon} <span>${message}</span>`;
      
      container.appendChild(toast);
      
      // Animate In
      requestAnimationFrame(() => {
        toast.classList.remove('translate-y-10', 'opacity-0');
      });

      // Remove after 3s
      setTimeout(() => {
        toast.classList.add('translate-y-5', 'opacity-0');
        setTimeout(() => toast.remove(), 300);
      }, 3500);
    }

    function syntaxHighlight(json) {
      json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
      return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
        let cls = 'json-value';
        if (/^"/.test(match)) {
          if (/:$/.test(match)) cls = 'json-key';
          else cls = 'json-string';
        }
        return '<span class="' + cls + '">' + match + '</span>';
      });
    }

    // Modal Close Events
    document.getElementById('jsonModal').addEventListener('click', (e) => {
      if (e.target.id === 'jsonModal') closeModal();
    });
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeModal();
    });
  </script>
</body>
</html>